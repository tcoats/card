// Generated by CoffeeScript 1.7.1
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  define(['inject'], function(inject) {
    var Physics;
    Physics = (function() {
      function Physics() {
        this.calculatesteering = __bind(this.calculatesteering, this);
        this.seek = __bind(this.seek, this);
        this.apply = __bind(this.apply, this);
        this.register = __bind(this.register, this);
        this.step = __bind(this.step, this);
        this.maxspeed = 3;
        this.maxsteeringforce = 0.05;
        this.entities = [];
        inject.bind('step', this.step);
        inject.bind('register physics', this.register);
        inject.bind('apply force', this.apply);
        inject.bind('seek target', this.seek);
        inject.bind('calculate steering', this.calculatesteering);
      }

      Physics.prototype.step = function() {
        var entity, _i, _len, _ref, _results;
        _ref = this.entities;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          entity = _ref[_i];
          entity.v.add(entity.a);
          entity.a.mult(0);
          entity.a.limit(this.maxspeed);
          _results.push(inject.one('delta position')(entity.e(), entity.v));
        }
        return _results;
      };

      Physics.prototype.register = function(entity, v, a) {
        entity.p = {
          v: v,
          a: a,
          e: function() {
            return entity;
          }
        };
        return this.entities.push(entity.p);
      };

      Physics.prototype.apply = function(entity, f) {
        return entity.p.a.add(f);
      };

      Physics.prototype.seek = function(entity, target) {};

      Physics.prototype.calculatesteering = function(entity, steer) {
        var result;
        result = steer.get();
        result.normalize();
        result.mult(this.maxspeed);
        result.sub(entity.p.v);
        result.limit(this.maxsteeringforce);
        return result;
      };

      return Physics;

    })();
    return new Physics();
  });

}).call(this);
